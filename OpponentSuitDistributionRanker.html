<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contract Bridge: Suit Split Practice</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Tailwind gray-100 */
        }
        .suit-icon {
            display: inline-block;
            width: 1.2em;
            height: 1.2em;
            margin-right: 0.25em;
            vertical-align: middle;
        }
        .spade { color: #2c3e50; } /* Dark blue/black */
        .heart { color: #e74c3c; } /* Red */
        .diamond { color: #f39c12; } /* Orange */
        .club { color: #27ae60; } /* Green */

        input[type="number"] {
            -moz-appearance: textfield;
            appearance: textfield;
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid #d1d5db; /* gray-300 */
            padding: 0.5rem 0.75rem; /* py-2 px-3 */
            width: 4rem; /* w-16 */
            text-align: center;
        }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        .feedback-correct {
            border-color: #10b981; /* green-500 */
        }
        .feedback-incorrect {
            border-color: #ef4444; /* red-500 */
        }
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 600;
            transition: background-color 0.2s ease-in-out;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .btn-primary {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }
        .btn-primary:hover {
            background-color: #2563eb; /* blue-600 */
        }
        .btn-secondary {
            background-color: #6b7280; /* gray-500 */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #4b5563; /* gray-600 */
        }
        .feedback-message {
            min-width: 10rem; /* Allow space for percentage text */
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center p-4">
    <div id="bridgeApp" class="bg-white p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-3xl">
        <header class="mb-6 text-center">
            <h1 class="text-3xl font-bold text-gray-800">Bridge Suit Split Practice</h1>
            <p class="text-gray-600 mt-2">You are Declarer. Given your hand and Dummy's (both 13 cards), predict the opponent card splits.</p>
        </header>

        <main>
            <section id="handsDisplay" class="mb-8 p-4 bg-blue-50 rounded-lg shadow">
                <h2 class="text-xl font-semibold text-blue-700 mb-3">Current Deal:</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div id="declarerHand" class="p-3 bg-white rounded shadow-sm">
                        <h3 class="font-medium text-gray-700">Declarer's Hand (13 cards):</h3>
                        <p class="text-sm text-gray-600">
                            <span class="suit-icon spade">♠</span> Spades: <span id="declarerS" class="font-semibold">0</span>,
                            <span class="suit-icon heart">♥</span> Hearts: <span id="declarerH" class="font-semibold">0</span><br>
                            <span class="suit-icon diamond">♦</span> Diamonds: <span id="declarerD" class="font-semibold">0</span>,
                            <span class="suit-icon club">♣</span> Clubs: <span id="declarerC" class="font-semibold">0</span>
                        </p>
                    </div>
                    <div id="dummyHand" class="p-3 bg-white rounded shadow-sm">
                        <h3 class="font-medium text-gray-700">Dummy's Hand (13 cards):</h3>
                        <p class="text-sm text-gray-600">
                            <span class="suit-icon spade">♠</span> Spades: <span id="dummyS" class="font-semibold">0</span>,
                            <span class="suit-icon heart">♥</span> Hearts: <span id="dummyH" class="font-semibold">0</span><br>
                            <span class="suit-icon diamond">♦</span> Diamonds: <span id="dummyD" class="font-semibold">0</span>,
                            <span class="suit-icon club">♣</span> Clubs: <span id="dummyC" class="font-semibold">0</span>
                        </p>
                    </div>
                </div>
            </section>

            <section id="suitAnalysis" class="space-y-6 mb-8">
                </section>

            <section id="controls" class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4 mt-8">
                <button id="checkAnswersBtn" class="btn btn-primary w-full sm:w-auto">Check Answers</button>
                <button id="newDealBtn" class="btn btn-secondary w-full sm:w-auto">New Deal</button>
            </section>
             <div id="overallFeedback" class="mt-6 text-center text-lg font-medium"></div>
        </main>
    </div>

    <script>
        // --- Data ---
        const SUITS = ['S', 'H', 'D', 'C']; // Order for iteration
        const SUIT_KEYS = { SPADES: 'S', HEARTS: 'H', DIAMONDS: 'D', CLUBS: 'C' }; // For clarity in generation
        const SUIT_DETAILS = {
            'S': { name: 'Spades', icon: '♠', class: 'spade' },
            'H': { name: 'Hearts', icon: '♥', class: 'heart' },
            'D': { name: 'Diamonds', icon: '♦', class: 'diamond' },
            'C': { name: 'Clubs', icon: '♣', class: 'club' }
        };

        // Predefined likely splits for N missing cards, including percentages.
        // Each inner object is { split: [val1, val2], P: "percentage_string" }, ordered by likelihood.
        const SUIT_SPLIT_LIKELIHOODS = {
            0: [{ split: [0, 0], P: "100%" }],
            1: [{ split: [1, 0], P: "100%" }],
            2: [{ split: [1, 1], P: "52%" }, { split: [2, 0], P: "48%" }],
            3: [{ split: [2, 1], P: "78%" }, { split: [3, 0], P: "22%" }],
            4: [{ split: [3, 1], P: "49.74%" }, { split: [2, 2], P: "39.73%" }, { split: [4, 0], P: "10.53%" }], // Note: BridgeBum has slightly different % for 3-1 (48.05) and 4-0(12.22) but order is same. Using common figures.
            5: [{ split: [3, 2], P: "67.83%" }, { split: [4, 1], P: "28.26%" }, { split: [5, 0], P: "3.91%" }],
            6: [{ split: [4, 2], P: "48.45%" }, { split: [3, 3], P: "35.53%" }, { split: [5, 1], P: "14.53%" }, { split: [6, 0], P: "1.49%" }],
            7: [{ split: [4, 3], P: "62.17%" }, { split: [5, 2], P: "30.55%" }, { split: [6, 1], P: "6.79%" }, { split: [7, 0], P: "0.49%" }],
            8: [{ split: [5, 3], P: "47.12%" }, { split: [4, 4], P: "32.72%" }, { split: [6, 2], P: "17.14%" }, { split: [7, 1], P: "2.86%" }, { split: [8, 0], P: "0.16%" }],
            9: [{ split: [5, 4], P: "58.96%" }, { split: [6, 3], P: "31.16%" }, { split: [7, 2], P: "8.90%" }, { split: [8, 1], P: "0.95%" }, { split: [9, 0], P: "0.03%" }],
            10: [{ split: [6, 4], P: "48.79%" }, { split: [5, 5], P: "33.46%" }, { split: [7, 3], P: "14.73%" }, { split: [8, 2], P: "2.82%" }, { split: [9, 1], P: "0.19%" }, { split: [10, 0], P: "0.005%" }],
            11: [{ split: [6, 5], P: "57.54%" }, { split: [7, 4], P: "31.51%" }, { split: [8, 3], P: "9.45%" }, { split: [9, 2], P: "1.39%" }, { split: [10, 1], P: "0.10%" }, { split: [11, 0], P: "0.002%" }],
            12: [{ split: [7, 5], P: "49.04%" }, { split: [6, 6], P: "33.88%" }, { split: [8, 4], P: "13.99%" }, { split: [9, 3], P: "2.72%" }, { split: [10, 2], P: "0.34%" }, { split: [11, 1], P: "0.02%" }, { split: [12, 0], P: "0.0004%" }],
            13: [{ split: [7, 6], P: "56.52%" }, { split: [8, 5], P: "31.85%" }, { split: [9, 4], P: "9.83%" }, { split: [10, 3], P: "1.57%" }, { split: [11, 2], P: "0.12%" }, { split: [12, 1], P: "0.003%" }, { split: [13, 0], P: "0.00002%" }]
        };

        let currentDeal = {
            declarer: { S: 0, H: 0, D: 0, C: 0 },
            dummy: { S: 0, H: 0, D: 0, C: 0 }
        };

        // --- DOM Elements ---
        const declarerSpadesEl = document.getElementById('declarerS');
        const declarerHeartsEl = document.getElementById('declarerH');
        const declarerDiamondsEl = document.getElementById('declarerD');
        const declarerClubsEl = document.getElementById('declarerC');

        const dummySpadesEl = document.getElementById('dummyS');
        const dummyHeartsEl = document.getElementById('dummyH');
        const dummyDiamondsEl = document.getElementById('dummyD');
        const dummyClubsEl = document.getElementById('dummyC');

        const suitAnalysisSection = document.getElementById('suitAnalysis');
        const checkAnswersBtn = document.getElementById('checkAnswersBtn');
        const newDealBtn = document.getElementById('newDealBtn');
        const overallFeedbackEl = document.getElementById('overallFeedback');

        // --- Functions ---

        /**
         * Generates a single hand of 13 cards, distributed randomly among suits.
         * @returns {object} A hand object e.g., {S: 4, H: 3, D: 3, C: 3}
         */
        function generateSingleHand() {
            const hand = { S: 0, H: 0, D: 0, C: 0 };
            const suitKeysArray = Object.values(SUIT_KEYS); // ['S', 'H', 'D', 'C']
            for (let i = 0; i < 13; i++) {
                const randomSuitIndex = Math.floor(Math.random() * suitKeysArray.length);
                hand[suitKeysArray[randomSuitIndex]]++;
            }
            return hand;
        }

        /**
         * Generates a new random deal where declarer and dummy each have 13 cards,
         * and the combined total for any suit is <= 13.
         */
        function generateNewDeal() {
            let attempts = 0;
            while (attempts < 1000) { // Safety break for rare infinite loops
                const declarerHand = generateSingleHand();
                const dummyHand = generateSingleHand();
                let isValidDeal = true;
                for (const suit of SUITS) {
                    if (declarerHand[suit] + dummyHand[suit] > 13) {
                        isValidDeal = false;
                        break;
                    }
                }
                if (isValidDeal) {
                    currentDeal.declarer = declarerHand;
                    currentDeal.dummy = dummyHand;
                    return; // Found a valid deal
                }
                attempts++;
            }
            console.error("Failed to generate a valid deal after 1000 attempts. Using last attempt (may be invalid for suit analysis).");
            // Fallback: use the last generated hands even if they don't meet the suit sum criteria.
            // This is unlikely but prevents the app from freezing.
            // A more robust solution might involve a different generation algorithm if this becomes frequent.
        }


        /**
         * Updates the display of declarer and dummy hands.
         */
        function displayHands() {
            declarerSpadesEl.textContent = currentDeal.declarer.S;
            declarerHeartsEl.textContent = currentDeal.declarer.H;
            declarerDiamondsEl.textContent = currentDeal.declarer.D;
            declarerClubsEl.textContent = currentDeal.declarer.C;

            dummySpadesEl.textContent = currentDeal.dummy.S;
            dummyHeartsEl.textContent = currentDeal.dummy.H;
            dummyDiamondsEl.textContent = currentDeal.dummy.D;
            dummyClubsEl.textContent = currentDeal.dummy.C;
        }

        /**
         * Renders the suit analysis section with input fields.
         */
        function renderSuitAnalysis() {
            suitAnalysisSection.innerHTML = '';
            overallFeedbackEl.textContent = '';

            SUITS.forEach(suit => {
                const suitDetail = SUIT_DETAILS[suit];
                const declarerCount = currentDeal.declarer[suit];
                const dummyCount = currentDeal.dummy[suit];
                const missingCards = 13 - declarerCount - dummyCount;

                const suitDiv = document.createElement('div');
                suitDiv.className = 'p-4 bg-gray-50 rounded-lg shadow-sm';
                suitDiv.innerHTML = `
                    <h3 class="text-lg font-semibold mb-3 ${suitDetail.class}">
                        <span class="suit-icon">${suitDetail.icon}</span> ${suitDetail.name}
                        <span class="text-sm font-normal text-gray-600 ml-2">
                            (Declarer: ${declarerCount}, Dummy: ${dummyCount}) - Missing: ${missingCards}
                        </span>
                    </h3>
                `;

                const possibleSplitsData = SUIT_SPLIT_LIKELIHOODS[missingCards] || [];
                const numLinesToShow = Math.min(3, possibleSplitsData.length);

                if (missingCards < 0) {
                     suitDiv.innerHTML += `<p class="text-red-600">Error: Invalid card counts for this suit (D:${declarerCount} + Du:${dummyCount} > 13).</p>`;
                } else if (numLinesToShow === 0 && missingCards > 0) {
                     suitDiv.innerHTML += `<p class="text-gray-500">No common splits defined for ${missingCards} missing cards.</p>`;
                } else if (missingCards === 0) {
                     suitDiv.innerHTML += `<p class="text-gray-700 font-medium">0-0 (No cards missing, ${possibleSplitsData[0]?.P || '100%'})</p>`;
                }


                for (let i = 0; i < numLinesToShow; i++) {
                    const rankText = i === 0 ? "Most Likely:" : i === 1 ? "2nd Most Likely:" : "3rd Most Likely:";
                    const rowDiv = document.createElement('div');
                    rowDiv.className = 'flex items-center space-x-2 mb-3 pl-4';
                    rowDiv.innerHTML = `
                        <label class="w-36 text-sm text-gray-700">${rankText}</label>
                        <input type="number" min="0" max="${missingCards}" data-suit="${suit}" data-row="${i}" data-opp="1" class="w-16 text-sm" aria-label="${suitDetail.name} split ${i+1} opponent 1">
                        <span class="text-gray-700">-</span>
                        <input type="number" min="0" max="${missingCards}" data-suit="${suit}" data-row="${i}" data-opp="2" class="w-16 text-sm" aria-label="${suitDetail.name} split ${i+1} opponent 2">
                        <span class="feedback-message text-xs ml-2"></span>
                    `;
                    suitDiv.appendChild(rowDiv);
                }
                suitAnalysisSection.appendChild(suitDiv);
            });
        }

        /**
         * Checks the user's answers and provides feedback.
         */
        function checkAnswers() {
            let allCorrect = true;
            let anyInputMade = false;

            SUITS.forEach(suit => {
                const declarerCount = currentDeal.declarer[suit];
                const dummyCount = currentDeal.dummy[suit];
                const missingCards = 13 - declarerCount - dummyCount;

                if (missingCards < 0 || missingCards > 13) {
                    console.error(`Invalid missingCards count: ${missingCards} for suit ${suit}`);
                    return;
                }
                const correctSplitsDataForSuit = SUIT_SPLIT_LIKELIHOODS[missingCards] || [];
                const numLinesToShow = Math.min(3, correctSplitsDataForSuit.length);

                for (let i = 0; i < numLinesToShow; i++) {
                    const inputOpp1 = suitAnalysisSection.querySelector(`input[data-suit="${suit}"][data-row="${i}"][data-opp="1"]`);
                    const inputOpp2 = suitAnalysisSection.querySelector(`input[data-suit="${suit}"][data-row="${i}"][data-opp="2"]`);
                    const feedbackEl = suitAnalysisSection.querySelector(`input[data-suit="${suit}"][data-row="${i}"][data-opp="2"] + .feedback-message`);

                    inputOpp1.classList.remove('feedback-correct', 'feedback-incorrect');
                    inputOpp2.classList.remove('feedback-correct', 'feedback-incorrect');
                    feedbackEl.textContent = '';
                    feedbackEl.className = 'feedback-message text-xs ml-2';


                    if (!inputOpp1.value && !inputOpp2.value) {
                        continue;
                    }
                    anyInputMade = true;

                    const val1 = parseInt(inputOpp1.value);
                    const val2 = parseInt(inputOpp2.value);

                    if (isNaN(val1) || isNaN(val2)) {
                        inputOpp1.classList.add('feedback-incorrect');
                        inputOpp2.classList.add('feedback-incorrect');
                        feedbackEl.textContent = 'Invalid input.';
                        feedbackEl.classList.add('text-red-600');
                        allCorrect = false;
                        continue;
                    }

                    if (val1 + val2 !== missingCards) {
                        inputOpp1.classList.add('feedback-incorrect');
                        inputOpp2.classList.add('feedback-incorrect');
                        feedbackEl.textContent = `Sum must be ${missingCards}.`;
                        feedbackEl.classList.add('text-red-600');
                        allCorrect = false;
                        continue;
                    }

                    if (!correctSplitsDataForSuit[i]) {
                        console.error(`No defined split data for suit ${suit}, missing ${missingCards}, rank ${i}`);
                        inputOpp1.classList.add('feedback-incorrect');
                        inputOpp2.classList.add('feedback-incorrect');
                        feedbackEl.textContent = `Logic error.`;
                        feedbackEl.classList.add('text-red-600');
                        allCorrect = false;
                        continue;
                    }

                    const expectedSplitObj = correctSplitsDataForSuit[i];
                    const expectedSplit = expectedSplitObj.split; // e.g., [3,2]
                    const percentage = expectedSplitObj.P; // e.g., "67.83%"

                    const isCorrect = (val1 === expectedSplit[0] && val2 === expectedSplit[1]) ||
                                      (val1 === expectedSplit[1] && val2 === expectedSplit[0]);

                    if (isCorrect) {
                        inputOpp1.classList.add('feedback-correct');
                        inputOpp2.classList.add('feedback-correct');
                        feedbackEl.textContent = `Correct! (${percentage})`;
                        feedbackEl.classList.add('text-green-600');
                    } else {
                        inputOpp1.classList.add('feedback-incorrect');
                        inputOpp2.classList.add('feedback-incorrect');
                        feedbackEl.textContent = `Expected: ${expectedSplit[0]}-${expectedSplit[1]} (${percentage})`;
                        feedbackEl.classList.add('text-red-600');
                        allCorrect = false;
                    }
                }
            });
             if (!anyInputMade) {
                overallFeedbackEl.textContent = "Please enter some splits to check.";
                overallFeedbackEl.className = 'mt-6 text-center text-lg font-medium text-yellow-600';
            } else if (allCorrect) {
                overallFeedbackEl.textContent = "Excellent! All shown splits are correct!";
                overallFeedbackEl.className = 'mt-6 text-center text-lg font-medium text-green-600';
            } else {
                overallFeedbackEl.textContent = "Some splits are incorrect. Review the feedback.";
                overallFeedbackEl.className = 'mt-6 text-center text-lg font-medium text-red-600';
            }
        }

        /**
         * Initializes the application.
         */
        function initializeApp() {
            generateNewDeal();
            displayHands();
            renderSuitAnalysis();

            checkAnswersBtn.addEventListener('click', checkAnswers);
            newDealBtn.addEventListener('click', () => {
                generateNewDeal();
                displayHands();
                renderSuitAnalysis();
            });
        }

        // --- Start the app ---
        initializeApp();
    </script>
</body>
</html>
